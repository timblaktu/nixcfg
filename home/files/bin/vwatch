#!/usr/bin/env bash
# vwatch: Like watch, but doesn't clear screen, shows history
#
# Usage: vwatch [-n SECONDS] [-t|--no-title] COMMAND [ARGS...]

interval=2
title=1

while [[ $1 == -* ]]; do
  case $1 in
    --no-title) title=0; shift ;;
    -t*)        title=0; [[ $1 == -t* ]] && [[ $1 != -t ]] && set -- "-${1#-t}" "${@:2}" || shift ;;
    -n*)        val="${1#-n}"; [[ -z $val ]] && val=$2 && shift; interval=$val; shift ;;
    --)         shift; break ;;
    *) echo "vwatch: unrecognized option '$1'" >&2; exit 1 ;;
  esac
done

[[ $# -eq 0 ]] && { echo "vwatch: missing command" >&2; exit 1; }

clear
while true; do
  (( title )) && echo "=== $(date '+%F %T') ==="
  "$@"
  sleep "$interval"
done
